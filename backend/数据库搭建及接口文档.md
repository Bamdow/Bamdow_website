# 数据库搭建及接口文档

## 1. 数据库建表语句

### 1.1 项目主表 (projects)
```sql
CREATE TABLE `projects` (
  `id` VARCHAR(36) NOT NULL PRIMARY KEY COMMENT '项目ID',
  `title` VARCHAR(255) NOT NULL COMMENT '项目标题',
  `subtitle` VARCHAR(255) DEFAULT '' COMMENT '项目副标题',
  `description` TEXT NOT NULL COMMENT '项目描述',
  `role` VARCHAR(255) NOT NULL COMMENT '项目角色',
  `image` VARCHAR(500) NOT NULL COMMENT '项目封面图片URL',
  `category` VARCHAR(50) NOT NULL COMMENT '项目分类：Photography, Development, Other',
  `tags` TEXT COMMENT '项目标签，用逗号分隔',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 1.2 摄影项目表 (photography_projects)
```sql
CREATE TABLE `photography_projects` (
  `id` VARCHAR(36) NOT NULL PRIMARY KEY COMMENT '摄影项目ID，与projects表id关联',
  `thoughts` TEXT COMMENT '思路&感受',
  `additional_info` TEXT COMMENT '补充信息',
  `gallery` TEXT COMMENT '相册图片URL，用逗号分隔',
  FOREIGN KEY (`id`) REFERENCES `projects`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 1.3 开发项目表 (development_projects)
```sql
CREATE TABLE `development_projects` (
  `id` VARCHAR(36) NOT NULL PRIMARY KEY COMMENT '开发项目ID，与projects表id关联',
  `github_url` VARCHAR(500) COMMENT 'GitHub链接',
  `website_url` VARCHAR(500) COMMENT '网站链接',
  `video_url` VARCHAR(500) COMMENT '视频URL',
  `bilibili_id` VARCHAR(50) COMMENT 'B站视频ID',
  `figma_url` VARCHAR(500) COMMENT 'Figma链接',
  `icon` VARCHAR(50) COMMENT '图标名称',
  FOREIGN KEY (`id`) REFERENCES `projects`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 1.4 其他项目表 (other_projects)
```sql
CREATE TABLE `other_projects` (
  `id` VARCHAR(36) NOT NULL PRIMARY KEY COMMENT '其他项目ID，与projects表id关联',
  `external_link` VARCHAR(500) COMMENT '外部链接',
  FOREIGN KEY (`id`) REFERENCES `projects`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 2. Java后端类设计

### 2.1 POJO类

#### 2.1.1 项目主类 (Project)
```java
import lombok.Data;
import java.sql.Timestamp;

@Data
public class Project {
    private String id;
    private String title;
    private String subtitle;
    private String description;
    private String role;
    private String image;
    private String category;
    private String tags;
    private Timestamp createdAt;
    private Timestamp updatedAt;
}
```

#### 2.1.2 摄影项目类 (PhotographyProject)
```java
import lombok.Data;

@Data
public class PhotographyProject {
    private String id;
    private String thoughts;
    private String additionalInfo;
    private String gallery;
}
```

#### 2.1.3 开发项目类 (DevelopmentProject)
```java
import lombok.Data;

@Data
public class DevelopmentProject {
    private String id;
    private String githubUrl;
    private String websiteUrl;
    private String videoUrl;
    private String bilibiliId;
    private String figmaUrl;
    private String icon;
}
```

#### 2.1.4 其他项目类 (OtherProject)
```java
import lombok.Data;

@Data
public class OtherProject {
    private String id;
    private String externalLink;
}
```

### 2.2 DTO类

#### 2.2.1 项目创建DTO (ProjectCreateDTO)
```java
import lombok.Data;

@Data
public class ProjectCreateDTO {
    private String title;
    private String subtitle;
    private String description;
    private String role;
    private String image;
    private String category;
    private String tags;
    
    // 摄影项目特有字段
    private String thoughts;
    private String additionalInfo;
    private String gallery;
    
    // 开发项目特有字段
    private String githubUrl;
    private String websiteUrl;
    private String videoUrl;
    private String bilibiliId;
    private String figmaUrl;
    private String icon;
    
    // 其他项目特有字段
    private String externalLink;
}
```

#### 2.2.2 项目更新DTO (ProjectUpdateDTO)
```java
import lombok.Data;

@Data
public class ProjectUpdateDTO {
    private String title;
    private String subtitle;
    private String description;
    private String role;
    private String image;
    private String tags;
    
    // 摄影项目特有字段
    private String thoughts;
    private String additionalInfo;
    private String gallery;
    
    // 开发项目特有字段
    private String githubUrl;
    private String websiteUrl;
    private String videoUrl;
    private String bilibiliId;
    private String figmaUrl;
    private String icon;
    
    // 其他项目特有字段
    private String externalLink;
}
```

### 2.3 VO类

#### 2.3.1 项目详情VO (ProjectDetailVO)
```java
import lombok.Data;
import java.sql.Timestamp;
import java.util.List;

@Data
public class ProjectDetailVO {
    private String id;
    private String title;
    private String subtitle;
    private String description;
    private String role;
    private String image;
    private String category;
    private List<String> tags;
    private Timestamp createdAt;
    private Timestamp updatedAt;
    
    // 摄影项目特有字段
    private String thoughts;
    private String additionalInfo;
    private List<String> gallery;
    
    // 开发项目特有字段
    private String githubUrl;
    private String websiteUrl;
    private String videoUrl;
    private String bilibiliId;
    private String figmaUrl;
    private String icon;
    
    // 其他项目特有字段
    private String externalLink;
    
    //  bilingual title for frontend
    private BilingualTitle bilingualTitle;
    
    @Data
    public static class BilingualTitle {
        private String zh;
        private String en;
    }
}
```

#### 2.3.2 项目列表VO (ProjectListVO)
```java
import lombok.Data;
import java.util.List;

@Data
public class ProjectListVO {
    private String id;
    private String title;
    private String subtitle;
    private String description;
    private String role;
    private String image;
    private String category;
    private List<String> tags;
    
    //  bilingual title for frontend
    private BilingualTitle bilingualTitle;
    
    @Data
    public static class BilingualTitle {
        private String zh;
        private String en;
    }
}
```

## 3. 接口文档

### 3.1 项目管理接口

#### 3.1.1 获取项目列表
- **接口路径**: `/api/projects`
- **请求方法**: GET
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `category` | String | 否 | 项目分类，可选值：All, Photography, Development, Other |
  | `page` | Integer | 否 | 页码，默认1 |
  | `size` | Integer | 否 | 每页大小，默认16 |

- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 10,
    "items": [
      {
        "id": "1",
        "title": "风景",
        "subtitle": "",
        "description": "山河仍在，只是故人改",
        "role": "摄影, 后期",
        "image": "https://example.com/image.jpg",
        "category": "Photography",
        "tags": ["风景", "自然", "旅行"],
        "bilingualTitle": {
          "zh": "风景",
          "en": "Landscape"
        }
      }
    ]
  }
}
```

#### 3.1.2 获取项目详情
- **接口路径**: `/api/projects/{id}`
- **请求方法**: GET
- **路径参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `id` | String | 是 | 项目ID |

- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "1",
    "title": "风景",
    "subtitle": "",
    "description": "山河仍在，只是故人改",
    "role": "摄影, 后期",
    "image": "https://example.com/image.jpg",
    "category": "Photography",
    "tags": ["风景", "自然", "旅行"],
    "createdAt": "2026-02-19T12:00:00",
    "updatedAt": "2026-02-19T12:00:00",
    "thoughts": "通过镜头捕捉大自然的壮丽与变迁",
    "additionalInfo": "最佳风景摄影奖",
    "gallery": ["https://example.com/gallery1.jpg", "https://example.com/gallery2.jpg"],
    "bilingualTitle": {
      "zh": "风景",
      "en": "Landscape"
    }
  }
}
```

#### 3.1.3 创建项目
- **接口路径**: `/api/projects`
- **请求方法**: POST
- **请求体**:
```json
{
  "title": "风景",
  "subtitle": "",
  "description": "山河仍在，只是故人改",
  "role": "摄影, 后期",
  "image": "https://example.com/image.jpg",
  "category": "Photography",
  "tags": "风景,自然,旅行",
  "thoughts": "通过镜头捕捉大自然的壮丽与变迁",
  "additionalInfo": "最佳风景摄影奖",
  "gallery": "https://example.com/gallery1.jpg,https://example.com/gallery2.jpg"
}
```

- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "1",
    "title": "风景",
    "subtitle": "",
    "description": "山河仍在，只是故人改",
    "role": "摄影, 后期",
    "image": "https://example.com/image.jpg",
    "category": "Photography",
    "tags": ["风景", "自然", "旅行"],
    "thoughts": "通过镜头捕捉大自然的壮丽与变迁",
    "additionalInfo": "最佳风景摄影奖",
    "gallery": ["https://example.com/gallery1.jpg", "https://example.com/gallery2.jpg"]
  }
}
```

#### 3.1.4 更新项目
- **接口路径**: `/api/projects/{id}`
- **请求方法**: PUT
- **路径参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `id` | String | 是 | 项目ID |

- **请求体**:
```json
{
  "title": "风景",
  "subtitle": "",
  "description": "山河仍在，只是故人改",
  "role": "摄影, 后期",
  "image": "https://example.com/image.jpg",
  "tags": "风景,自然,旅行",
  "thoughts": "通过镜头捕捉大自然的壮丽与变迁",
  "additionalInfo": "最佳风景摄影奖",
  "gallery": "https://example.com/gallery1.jpg,https://example.com/gallery2.jpg"
}
```

- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "1",
    "title": "风景",
    "subtitle": "",
    "description": "山河仍在，只是故人改",
    "role": "摄影, 后期",
    "image": "https://example.com/image.jpg",
    "category": "Photography",
    "tags": ["风景", "自然", "旅行"],
    "thoughts": "通过镜头捕捉大自然的壮丽与变迁",
    "additionalInfo": "最佳风景摄影奖",
    "gallery": ["https://example.com/gallery1.jpg", "https://example.com/gallery2.jpg"]
  }
}
```

#### 3.1.5 删除项目
- **接口路径**: `/api/admin/projects`
- **请求方法**: DELETE
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `ids` | List<String> | 是 | 项目ID列表，多个ID用逗号分隔 |

- **请求示例**:
  `/api/admin/projects?ids=1,2,3`

- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 3.2 文件上传接口

#### 3.2.1 上传图片
- **接口路径**: `/api/upload/image`
- **请求方法**: POST
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `file` | MultipartFile | 是 | 图片文件 |

- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "url": "https://example.com/upload/image.jpg"
  }
}
```

## 4. 数据结构说明

### 4.1 分类说明
- `Photography`: 静态照片
- `Development`: 软件开发
- `Other`: 其他

### 4.2 字段说明
- **id**: 项目唯一标识，使用UUID
- **title**: 项目标题，支持中英文
- **subtitle**: 项目副标题
- **description**: 项目描述
- **role**: 项目角色
- **image**: 项目封面图片URL，使用云服务存储
- **category**: 项目分类
- **tags**: 项目标签，多个标签用逗号分隔
- **thoughts**: 摄影项目的思路&感受
- **additionalInfo**: 摄影项目的补充信息
- **gallery**: 摄影项目的相册图片URL，多个URL用逗号分隔
- **githubUrl**: 开发项目的GitHub链接
- **websiteUrl**: 开发项目的网站链接
- **videoUrl**: 开发项目的视频URL
- **bilibiliId**: 开发项目的B站视频ID
- **figmaUrl**: 开发项目的Figma链接
- **icon**: 开发项目的图标名称
- **externalLink**: 其他项目的外部链接
- **bilingualTitle**: 前端使用的双语标题，包含中英文标题

## 5. 技术实现建议

1. **ID生成**: 使用UUID生成项目ID，确保唯一性
2. **图片存储**: 使用云服务存储图片，如阿里云OSS、腾讯云COS等
3. **数据校验**: 对所有输入字段进行校验，确保数据合法性
4. **错误处理**: 统一错误处理，返回标准的错误响应
5. **日志记录**: 记录关键操作的日志，便于排查问题
6. **缓存机制**: 对热门项目列表使用缓存，提高访问速度
7. **分页查询**: 实现分页查询，避免一次性返回过多数据
8. **CORS配置**: 配置CORS，允许前端跨域访问

## 6. 前端集成说明

1. **API调用**: 前端通过Axios等HTTP客户端调用后端API
2. **图片上传**: 先调用文件上传接口获取图片URL，再将URL填入项目创建/更新请求
3. **分类处理**: 前端根据选择的分类显示对应的表单字段
4. **标签处理**: 前端将标签数组转换为逗号分隔的字符串传递给后端
5. **相册处理**: 前端将相册图片URL数组转换为逗号分隔的字符串传递给后端
6. **双语支持**: 后端返回的`bilingualTitle`字段用于前端切换语言时显示对应语言的标题

## 7. 数据库索引优化

为了提高查询性能，建议在以下字段上创建索引：

```sql
-- 为projects表的category字段创建索引
CREATE INDEX idx_projects_category ON projects(category);

-- 为projects表的created_at字段创建索引
CREATE INDEX idx_projects_created_at ON projects(created_at);
```

## 8. 安全考虑

1. **SQL注入**: 使用参数化查询，避免SQL注入攻击
2. **XSS攻击**: 对用户输入进行过滤，避免XSS攻击
3. **CSRF攻击**: 实现CSRF保护机制
4. **文件上传安全**: 对上传的文件进行类型和大小校验，避免恶意文件上传
5. **API鉴权**: 实现API鉴权机制，避免未授权访问
